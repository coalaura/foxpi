(()=>{var a=["GET","POST","PUT","PATCH","DELETE"];(async()=>{console.log("Connecting to native host...");let n=await browser.runtime.connectNative("foxpi");console.log("Connected to native host."),n.onDisconnect.addListener(()=>{console.log("Disconnected from native host.")}),n.onMessage.addListener(async e=>{if(!r(e)){console.log("Invalid request.",e);return}console.log(`Fetching "${e.method} ${e.url}"...`);let t=await i(e);console.log(`Sending response: ${t?.length||0} bytes`),n.postMessage(t)})})();function r(n){let{url:e,method:o,headers:t}=n;if(o||(o="GET"),t||(t={}),!e||!e.startsWith("http://")&&!e.startsWith("https://")||!a.includes(o)||typeof t!="object")return!1;for(let s in t)if(typeof s!="string"||typeof t[s]!="string")return!1;return{url:e,method:o,headers:t}}async function i(n){try{let e=await fetch(n.url,{method:n.method,headers:n.headers});if(!e.ok)return!1;let o=await e.arrayBuffer(),t=new Uint8Array(o);return{headers:e.headers,body:btoa(String.fromCharCode(...t)),length:t.length}}catch{}return!1}})();
