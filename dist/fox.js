(()=>{(async()=>{console.log("Connecting to native host...");let t=await browser.runtime.connectNative("foxpi");console.log("Connected to native host."),t.onDisconnect.addListener(()=>{console.log("Disconnected from native host.")}),t.onMessage.addListener(async e=>{if(!e||!e.startsWith("http://")&&!e.startsWith("https://")){console.log(`Unable to fetch invalid url: ${e}`);return}console.log(`Fetching "${e}"...`);let n=await s(e);console.log(`Sending response: ${n?.length||0} bytes`),t.postMessage(n)})})();async function s(t){try{let e=await fetch(t);if(!e.ok)return!1;let n=await e.arrayBuffer(),o=new Uint8Array(n);return{headers:e.headers,body:btoa(String.fromCharCode(...o)),length:o.length}}catch{}return!1}})();
